{% extends "master.html" %}

{% block title %}Attendance History{% endblock %}

{% block content %}
<link href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap4.min.css" rel="stylesheet">

<div class="card shadow mb-4">
    <div class="card-header py-3 d-flex justify-content-between align-items-center">
        <h6 class="m-0 font-weight-bold text-primary">Attendance Register üìã</h6>
        <a href="/attendance/" class="btn btn-primary btn-sm">
            <i class="fas fa-plus"></i> Mark New Attendance
        </a>
    </div>
    
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered table-hover" id="dataTable" width="100%" cellspacing="0">
                <thead class="thead-light">
                    <tr>
                        <th>Date</th>
                        <th>Student Name</th> <th>Class</th>
                        <th>Fees Info üí∞</th> <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for x in records %}
                    <tr>
                        <td>{{ x.date|date:"Y-m-d" }}</td> 
                        
                        <td class="font-weight-bold">
                            <a href="#" class="text-dark text-decoration-none student-popover"
                               data-toggle="popover" 
                               data-trigger="hover" 
                               data-html="true"
                               title="üë§ Student Profile"
                               data-content="
                                   <div class='text-center'>
                                       {% if x.student.profile_pic %}
                                           <img src='/media/{{ x.student.profile_pic }}' class='rounded-circle mb-2' width='70' height='70' style='object-fit:cover; border: 2px solid #ddd;'>
                                       {% else %}
                                           <div class='mb-2 text-gray-400'><i class='fas fa-user-circle fa-4x'></i></div>
                                       {% endif %}
                                       
                                       <h6 class='font-weight-bold text-primary mb-1'>{{ x.student.firstname }} {{ x.student.lastname }}</h6>
                                       <p class='small text-muted mb-2'>Class 12 - PCM</p>
                                       
                                       {% if x.student.due_amount > 0 %}
                                           <span class='badge badge-danger'>Due: ‚Çπ{{ x.student.due_amount }}</span>
                                       {% else %}
                                           <span class='badge badge-success'>Fees Clear ‚úÖ</span>
                                       {% endif %}
                                   </div>
                               ">
                               {{ x.student.firstname }} {{ x.student.lastname }}
                            </a>
                        </td>

                        <td>Class 12 - PCM</td> <td>
                            {% if x.student.fee_total == 0 %}
                                <span class="badge badge-secondary">Data Not Updated</span>
                            {% else %}
                                <small class="text-primary font-weight-bold">Total: ‚Çπ{{ x.student.fee_total }}</small><br>
                                <small class="text-danger font-weight-bold">Due: ‚Çπ{{ x.student.due_amount }}</small>
                            {% endif %}
                        </td>

                        <td class="text-center">
                            {% if x.status == 'Present' %}
                                <span class="badge badge-success px-2 py-1">Present</span>
                            {% elif x.status == 'Absent' %}
                                <span class="badge badge-danger px-2 py-1">Absent</span>
                            {% else %}
                                <span class="badge badge-warning px-2 py-1">Leave</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap4.min.js"></script>

<script>
    $(document).ready(function () {
        // Table Initialize karo
        var table = $('#dataTable').DataTable({
            "order": [[ 0, "desc" ]], // Latest date upar
            "pageLength": 10,
            "language": {
                "search": "üîç Search Record:"
            },
            // IMPORTANT: Jab page change ho (Next/Prev), tab bhi Popover activate karo
            "drawCallback": function() {
                $('[data-toggle="popover"]').popover();
            }
        });

        // Pehli baar load hone par activate karo
        $('[data-toggle="popover"]').popover();
    });
</script>
{% endblock %}
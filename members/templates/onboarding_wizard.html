{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register your school – Step {{ step }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            min-height: 100vh;
            background: linear-gradient(135deg, #0f172a 0%, #1e40af 50%, #1e3a8a 100%);
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem 1rem 3rem;
        }
        .container { max-width: 560px; width: 100%; }
        .card {
            background: rgba(255,255,255,0.98);
            color: #1f2937;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        }
        h1 { font-size: 1.5rem; margin: 0 0 0.5rem; color: #1e40af; }
        .step-badge { font-size: 0.85rem; color: #6b7280; margin-bottom: 1.5rem; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 0.35rem; }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 0.6rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
        }
        .form-group small { color: #6b7280; font-size: 0.8rem; }
        .btn {
            display: inline-block;
            padding: 0.6rem 1.25rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            font-size: 1rem;
            text-decoration: none;
        }
        .btn-primary { background: #1e40af; color: #fff; }
        .btn-primary:hover { background: #1e3a8a; }
        .btn-secondary { background: #e5e7eb; color: #374151; margin-left: 0.5rem; }
        .btn-secondary:hover { background: #d1d5db; }
        .mt-3 { margin-top: 1.5rem; }
        .flex { display: flex; flex-wrap: wrap; gap: 0.5rem; align-items: center; }
        .alert { padding: 0.75rem 1rem; border-radius: 8px; margin-bottom: 1rem; }
        .alert-error { background: #fef2f2; color: #b91c1c; border: 1px solid #fecaca; }
        .alert-success { background: #f0fdf4; color: #166534; border: 1px solid #bbf7d0; }
        .review-row { padding: 0.5rem 0; border-bottom: 1px solid #e5e7eb; }
        .review-row:last-child { border-bottom: none; }
        .review-label { font-weight: 600; color: #6b7280; }
        a.back-link { color: #93c5fd; text-decoration: none; font-size: 0.9rem; }
        a.back-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <p class="step-badge">Step {{ step }} of 3</p>
            <h1>
                {% if step == 1 %}School details
                {% elif step == 2 %}Owner account
                {% else %}Review & create
                {% endif %}
            </h1>

            {% if messages %}
                {% for message in messages %}
                    <div class="alert {% if message.tags == 'error' %}alert-error{% else %}alert-success{% endif %}">{{ message }}</div>
                {% endfor %}
            {% endif %}

            {% if step == 1 %}
                <form method="post" action="?step=1">
                    {% csrf_token %}
                    <div class="form-group">
                        <label>School name *</label>
                        <input type="text" name="name" value="{{ data.name|default:'' }}" placeholder="e.g. ABC Public School" required>
                    </div>
                    <div class="form-group">
                        <label>Address *</label>
                        <textarea name="address" rows="3" placeholder="Full address" required>{{ data.address|default:'' }}</textarea>
                    </div>
                    <div class="form-group">
                        <label>School code *</label>
                        <input type="text" name="school_code" value="{{ data.school_code|default:'' }}" placeholder="e.g. ABC001" required>
                        <small>Unique identifier (letters/numbers)</small>
                    </div>
                    <div class="form-group">
                        <label>Subdomain code</label>
                        <input type="text" name="code" value="{{ data.code|default:'' }}" placeholder="e.g. abc-school (optional)">
                        <small>Lowercase, no spaces. Used for: code.yoursite.com</small>
                    </div>
                    <div class="mt-3 flex">
                        <button type="submit" class="btn btn-primary">Next – Owner account</button>
                    </div>
                </form>
            {% endif %}

            {% if step == 2 %}
                <p><a href="?step=1" class="back-link">&larr; Back to school details</a></p>
                <form method="post" action="?step=2">
                    {% csrf_token %}
                    <div class="form-group">
                        <label>Username *</label>
                        <input type="text" name="owner_username" value="{{ data.owner_username|default:'' }}" required autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" name="owner_email" value="{{ data.owner_email|default:'' }}" placeholder="admin@school.com">
                    </div>
                    <div class="form-group">
                        <label>Password *</label>
                        <input type="password" name="owner_password" required minlength="8" autocomplete="new-password">
                        <small>At least 8 characters</small>
                    </div>
                    <div class="form-group">
                        <label>Confirm password *</label>
                        <input type="password" name="owner_password2" required autocomplete="new-password">
                    </div>
                    <div class="mt-3 flex">
                        <button type="submit" class="btn btn-primary">Next – Review</button>
                        <a href="?step=1" class="btn btn-secondary">Back</a>
                    </div>
                </form>
            {% endif %}

            {% if step == 3 %}
                <p><a href="?step=2" class="back-link">&larr; Back to owner account</a></p>
                <div class="review-row"><span class="review-label">School name</span><br>{{ data.name }}</div>
                <div class="review-row"><span class="review-label">Address</span><br>{{ data.address }}</div>
                <div class="review-row"><span class="review-label">School code</span><br>{{ data.school_code }}</div>
                <div class="review-row"><span class="review-label">Subdomain</span><br>{{ data.code }}</div>
                <div class="review-row"><span class="review-label">Owner</span><br>{{ data.owner_username }} ({{ data.owner_email|default:"—" }})</div>
                <form method="post" action="?step=3" class="mt-3">
                    {% csrf_token %}
                    <div class="flex">
                        <button type="submit" class="btn btn-primary">Create school &amp; owner account</button>
                        <a href="?step=2" class="btn btn-secondary">Back</a>
                    </div>
                </form>
            {% endif %}
        </div>
        <p style="text-align: center; margin-top: 1.5rem;">
            <a href="{% url 'landing' %}" class="back-link">Back to home</a> &middot;
            <a href="{% url 'login' %}" class="back-link">Already have an account? Log in</a>
        </p>
    </div>
</body>
</html>

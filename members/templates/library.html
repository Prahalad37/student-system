{% extends "master.html" %}
{% load static %}

{% block title %}Digital Library{% endblock %}

{% block content %}

<div class="row">
    
    <div class="col-xl-4 col-lg-5 mb-4">
        <div class="card shadow border-0">
            <div class="card-header py-3 bg-primary text-white">
                <h6 class="m-0 font-weight-bold"><i class="fas fa-cloud-upload-alt mr-2"></i>Upload Material</h6>
            </div>
            <div class="card-body">
                <form action="" method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <div class="form-group">
                        <label class="small font-weight-bold text-secondary">Title / Topic Name</label>
                        <input type="text" name="title" class="form-control" placeholder="e.g. Thermodynamics Notes" required>
                    </div>

                    <div class="row">
                        <div class="col-6 form-group">
                            <label class="small font-weight-bold text-secondary">Subject</label>
                            <select name="subject" class="form-control">
                                <option>Physics</option>
                                <option>Maths</option>
                                <option>Chemistry</option>
                                <option>English</option>
                                <option>Computer</option>
                                <option>Biology</option>
                                <option>History</option>
                            </select>
                        </div>
                        <div class="col-6 form-group">
                            <label class="small font-weight-bold text-secondary">Class</label>
                            <select name="class_name" class="form-control">
                                <option>Class 9</option>
                                <option>Class 10</option>
                                <option>Class 11</option>
                                <option>Class 12</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="small font-weight-bold text-secondary">Video Link (Optional)</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fab fa-youtube text-danger"></i></span>
                            </div>
                            <input type="url" name="video_link" class="form-control" placeholder="https://youtu.be/...">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="small font-weight-bold text-secondary">Upload PDF</label>
                        <div class="custom-file">
                            <input type="file" name="pdf_file" class="custom-file-input" id="customFile" accept=".pdf">
                            <label class="custom-file-label" for="customFile">Choose file...</label>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block font-weight-bold shadow-sm mt-4">
                        <i class="fas fa-paper-plane mr-2"></i> Upload & Publish
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div class="col-xl-8 col-lg-7">
        
        <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between mb-4">
            <div>
                <h1 class="h3 mb-1 text-gray-800 font-weight-bold">Library ðŸ“š</h1>
                <p class="text-muted mb-0 small">Total Resources: {{ materials.count }}</p>
            </div>
            
            <div class="mt-3 mt-md-0" style="width: 100%; max-width: 300px;">
                <div class="input-group shadow-sm">
                    <div class="input-group-prepend">
                        <span class="input-group-text bg-white border-0"><i class="fas fa-search text-gray-400"></i></span>
                    </div>
                    <input type="text" id="librarySearch" class="form-control border-0 bg-white small" placeholder="Search topics..." aria-label="Search">
                </div>
            </div>
        </div>

        <div class="row" id="libraryItems">
            {% for mat in materials %}
            <div class="col-md-6 mb-4 library-card">
                <div class="card h-100 border-0 shadow-sm" style="border-radius: 15px; overflow: hidden; transition: transform 0.2s;">
                    <div style="height: 5px; background: {% if mat.subject == 'Maths' %}#4e73df{% elif mat.subject == 'Physics' %}#e74a3b{% elif mat.subject == 'Chemistry' %}#f6c23e{% else %}#1cc88a{% endif %};"></div>
                    
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <span class="badge badge-light text-uppercase font-weight-bold px-2 py-1 border">
                                {{ mat.subject }}
                            </span>
                            <small class="text-muted font-weight-bold">{{ mat.class_name }}</small>
                        </div>

                        <h5 class="font-weight-bold text-dark mb-1 text-truncate" title="{{ mat.title }}">{{ mat.title }}</h5>
                        <p class="text-xs text-muted mb-3">
                            <i class="far fa-clock mr-1"></i> {{ mat.created_at|date:"d M, Y" }}
                        </p>

                        <div class="d-flex">
                            {% if mat.video_link %}
                                <a href="{{ mat.video_link }}" target="_blank" class="btn btn-danger btn-sm flex-fill mr-1 shadow-sm">
                                    <i class="fab fa-youtube"></i> Video
                                </a>
                            {% else %}
                                <button class="btn btn-light btn-sm flex-fill mr-1 text-muted" disabled>No Video</button>
                            {% endif %}

                            {% if mat.pdf_file %}
                                <a href="{{ mat.pdf_file.url }}" target="_blank" class="btn btn-info btn-sm flex-fill ml-1 shadow-sm">
                                    <i class="fas fa-file-pdf"></i> Notes
                                </a>
                            {% else %}
                                <button class="btn btn-light btn-sm flex-fill ml-1 text-muted" disabled>No PDF</button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center py-5">
                <h6 class="text-gray-500 mt-3">Library is Empty</h6>
                <p class="small text-muted">Use the form on the left to upload notes.</p>
            </div>
            {% endfor %}
        </div>

    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    document.getElementById('librarySearch').addEventListener('keyup', function() {
        let searchQuery = this.value.toLowerCase();
        let cards = document.getElementsByClassName('library-card');

        for (let i = 0; i < cards.length; i++) {
            let cardContent = cards[i].innerText.toLowerCase();
            if (cardContent.includes(searchQuery)) {
                cards[i].style.display = "block"; 
            } else {
                cards[i].style.display = "none";
            }
        }
    });

    $(".custom-file-input").on("change", function() {
        var fileName = $(this).val().split("\\").pop();
        $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
    });
</script>
{% endblock %}
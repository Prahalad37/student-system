{% extends 'master.html' %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h2 class="mb-4"><i class="fas fa-book-reader"></i> Library Management</h2>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white p-3">
            <h4>{{ total_books }}</h4>
            <p>Total Books</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-dark p-3">
            <h4>{{ issued_books }}</h4>
            <p>Books Issued</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white p-3">
            <h4><a href="/library/export/" class="text-white">Download Report</a></h4>
            <p>Export Excel</p>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="card p-3 mb-4">
            <h5>Add New Book</h5>
            <form action="/library/add_book/" method="POST">
                {% csrf_token %}
                <input type="text" name="title" class="form-control mb-2" placeholder="Book Title" required>
                <input type="text" name="author" class="form-control mb-2" placeholder="Author Name" required>
                <input type="text" name="isbn" class="form-control mb-2" placeholder="ISBN (Optional)">
                <input type="number" name="copies" class="form-control mb-2" placeholder="Total Copies" required>
                <button type="submit" class="btn btn-primary w-100">Add Book</button>
            </form>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card p-3 mb-4">
            <h5>Issue Book</h5>
            <form action="/library/issue_book/" method="POST">
                {% csrf_token %}
                <select name="student_id" class="form-control mb-2" required>
                    <option value="">Select Student</option>
                    {% for student in all_students %}
                    <option value="{{ student.id }}">{{ student.firstname }} {{ student.lastname }} ({{ student.student_class }})</option>
                    {% endfor %}
                </select>
                <select name="book_id" class="form-control mb-2" required>
                    <option value="">Select Book</option>
                    {% for book in books %}
                    <option value="{{ book.id }}">{{ book.title }} ({{ book.available_copies }} left)</option>
                    {% endfor %}
                </select>
                <label>Due Date:</label>
                <input type="date" name="due_date" class="form-control mb-2" required>
                <button type="submit" class="btn btn-warning w-100">Issue Book</button>
            </form>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card p-3">
            <h5>Currently Issued Books</h5>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Student</th>
                        <th>Book</th>
                        <th>Issued Date</th>
                        <th>Due Date</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for t in transactions %}
                    <tr>
                        <td>{{ t.student.firstname }} {{ t.student.lastname }}</td>
                        <td>{{ t.book.title }}</td>
                        <td>{{ t.issue_date }}</td>
                        <td>{{ t.due_date }}</td>
                        <td>
                            <a href="/library/return_book/{{ t.id }}" class="btn btn-sm btn-success">Return</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center">No books currently issued.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% include "components/pagination.html" %}
    </div>
</div>
{% endblock %}
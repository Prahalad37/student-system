{% extends "master.html" %}
{% load static %}

{% block title %}Student Portal - My Materials{% endblock %}

{% block sidebar_nav %}
<li class="nav-item active">
    <a class="nav-link" href="{% url 'student_portal' %}">
        <i class="fas fa-fw fa-book-open"></i>
        <span>My Materials</span>
    </a>
</li>
<li class="nav-item">
    <a class="nav-link" href="{% url 'logout' %}">
        <i class="fas fa-fw fa-sign-out-alt"></i>
        <span>Logout</span>
    </a>
</li>
<hr class="sidebar-divider d-none d-md-block">
<div class="text-center d-none d-md-inline">
    <button class="rounded-circle border-0" id="sidebarToggle"></button>
</div>
{% endblock sidebar_nav %}

{% block breadcrumbs %}
<nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb bg-transparent py-2 mb-0">
        <li class="breadcrumb-item active">Student Portal</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800 font-weight-bold"><i class="fas fa-book-open text-primary mr-2"></i>My Study Materials</h1>
</div>

{% if member %}
<p class="text-muted mb-4">Materials for {{ member.student_class|default:"your class" }}</p>
{% else %}
<p class="text-warning mb-4">Your account is not linked to a student record. Contact admin to link your profile.</p>
{% endif %}

<div class="row">
    {% for item in materials %}
    <div class="col-lg-6 mb-4">
        <div class="card shadow border-left-primary h-100">
            <div class="card-body">
                <h6 class="font-weight-bold text-dark">{{ item.obj.title }}</h6>
                <small class="text-muted">{{ item.obj.subject }} | {{ item.obj.class_name }}</small>
                <div class="mt-3">
                    {% if item.obj.pdf_file %}
                    <a href="{{ item.obj.pdf_file.url }}" target="_blank" class="btn btn-sm btn-primary mr-2"><i class="fas fa-file-pdf mr-1"></i>Download PDF</a>
                    {% endif %}
                    {% if item.embed_url %}
                    <button type="button" class="btn btn-sm btn-danger" data-toggle="collapse" data-target="#video-{{ item.obj.id }}"><i class="fab fa-youtube mr-1"></i>Watch Video</button>
                    {% endif %}
                </div>
                {% if item.embed_url %}
                <div id="video-{{ item.obj.id }}" class="collapse mt-3">
                    <div class="embed-responsive embed-responsive-16by9">
                        <iframe class="embed-responsive-item" src="{{ item.embed_url }}" allowfullscreen></iframe>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="card shadow">
            <div class="card-body text-center py-5 text-muted">
                <i class="fas fa-folder-open fa-3x mb-3"></i>
                <p>No study materials available for your class yet.</p>
                <p class="small">Your teacher will add materials soon.</p>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

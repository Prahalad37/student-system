{% extends "master.html" %}
{% load static %}

{% block title %}Timetable{% endblock %}

{% block content %}
<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800"><i class="fas fa-calendar-alt text-primary mr-2"></i>Timetable</h1>
    {% if is_owner or is_admin %}
    <a href="{% url 'timetable_edit' %}" class="btn btn-primary">Edit timetable</a>
    {% endif %}
</div>

<form method="get" class="form-inline mb-4">
    <label class="mr-2">Class</label>
    <select name="class_id" class="form-control form-control-sm mr-3">
        <option value="">— Select class —</option>
        {% for c in classes %}
        <option value="{{ c.id }}" {% if selected_class_id == c.id|stringformat:"s" %}selected{% endif %}>{{ c.name }} - {{ c.section }}</option>
        {% endfor %}
    </select>
    <label class="mr-2">Teacher</label>
    <select name="teacher_id" class="form-control form-control-sm mr-3">
        <option value="">— Select teacher —</option>
        {% for t in teachers %}
        <option value="{{ t.id }}" {% if selected_teacher_id == t.id|stringformat:"s" %}selected{% endif %}>{{ t.first_name }} {{ t.last_name }}</option>
        {% endfor %}
    </select>
    <button type="submit" class="btn btn-sm btn-primary">Show</button>
</form>

<div class="card shadow mb-4">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-bordered table-sm mb-0 timetable-grid">
                <thead class="bg-light">
                    <tr>
                        <th>Slot</th>
                        {% for d in days %}
                        <th class="text-center">{% if d == 1 %}Mon{% elif d == 2 %}Tue{% elif d == 3 %}Wed{% elif d == 4 %}Thu{% elif d == 5 %}Fri{% else %}Sat{% endif %}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for slot, row_entries in rows %}
                    <tr>
                        <td class="font-weight-bold">{{ slot.start_time|time:"H:i" }}-{{ slot.end_time|time:"H:i" }}</td>
                        {% for e in row_entries %}
                        <td class="p-2">
                            {% if e %}
                            <div class="small">{{ e.subject.name }}</div>
                            <div class="text-muted" style="font-size:0.75rem;">{{ e.staff.first_name|default:"—" }} {{ e.staff.last_name|default:"" }}</div>
                            {% else %}
                            —
                            {% endif %}
                        </td>
                        {% endfor %}
                    </tr>
                    {% empty %}
                    <tr><td colspan="7" class="text-center py-4 text-muted">No slots defined. Add slots in Edit timetable.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

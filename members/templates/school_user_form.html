


{% extends "master.html" %}
{% load static %}

{% block title %}{% if edit %}Edit user{% else %}Add user{% endif %}{% endblock %}

{% block breadcrumbs %}
<nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb bg-transparent py-2 mb-0">
        <li class="breadcrumb-item"><a href="{% url 'index' %}">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="{% url 'school_settings' %}">School Settings</a></li>
        <li class="breadcrumb-item"><a href="{% url 'school_user_list' %}">Manage users</a></li>
        <li class="breadcrumb-item active">{% if edit %}Edit user{% else %}Add user{% endif %}</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800 font-weight-bold"><i class="fas fa-user-{% if edit %}edit{% else %}plus{% endif %} text-primary mr-2"></i>{% if edit %}Edit user{% else %}Add user{% endif %}</h1>
    <a href="{% url 'school_user_list' %}" class="btn btn-secondary"><i class="fas fa-arrow-left mr-2"></i>Back</a>
</div>

<div class="row">
    <div class="col-lg-6">
        <div class="card shadow mb-4">
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    {% if edit %}
                        <div class="form-group">
                            <label>Username</label>
                            <input type="text" class="form-control" value="{{ profile.user.username }}" disabled>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label>Username *</label>
                            <input type="text" name="username" class="form-control" required placeholder="e.g. jdoe">
                        </div>
                    {% endif %}
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" name="email" class="form-control" value="{% if edit %}{{ profile.user.email }}{% endif %}" placeholder="user@school.com">
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <select name="role" class="form-control">
                            {% for value, label in roles %}
                                <option value="{{ value }}" {% if edit and profile.role == value %}selected{% endif %}>{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    {% if edit %}
                        <div class="form-group">
                            <label>Active</label>
                            <select name="is_active" class="form-control">
                                <option value="1" {% if profile.user.is_active %}selected{% endif %}>Yes</option>
                                <option value="0" {% if not profile.user.is_active %}selected{% endif %}>No</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>New password (leave blank to keep current)</label>
                            <input type="password" name="password" class="form-control" minlength="8" placeholder="Min 8 characters">
                        </div>
                        {% if profile.role == "PARENT" and students %}
                        <div class="form-group">
                            <label>Linked students (guardian of)</label>
                            <select name="guardian_of" class="form-control" multiple size="5">
                                {% for s in students %}
                                <option value="{{ s.id }}" {% if s.id in guardian_ids %}selected{% endif %}>{{ s.firstname }} {{ s.lastname }} ({{ s.student_class|default:"â€”" }})</option>
                                {% endfor %}
                            </select>
                            <small class="text-muted">Hold Ctrl/Cmd to select multiple.</small>
                        </div>
                        {% endif %}
                    {% else %}
                        <div class="form-group">
                            <label>Password *</label>
                            <input type="password" name="password" class="form-control" required minlength="8">
                        </div>
                    {% endif %}
                    <button type="submit" class="btn btn-primary">{% if edit %}Save changes{% else %}Add user{% endif %}</button>
                    <a href="{% url 'school_user_list' %}" class="btn btn-secondary">Cancel</a>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
